name: Simple Auto PR

on:
  push:
    branches-ignore:
      - main
      - master
      - develop

jobs:
  create-pr:
    runs-on: ubuntu-latest
    if: github.ref != 'refs/heads/main' && github.ref != 'refs/heads/master' && github.ref != 'refs/heads/develop'
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v5
      id: cpr
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        title: "🤖 Auto PR: ${{ github.ref_name }}"
        body: |
          ## 🤖 自動生成されたPull Request
          
          **ブランチ**: `${{ github.ref_name }}`
          **ベース**: `main`
          
          ### 📝 変更内容
          このPRは自動的に作成されました。変更内容を確認してレビューをお願いします。
          
          ### 🔍 チェックリスト
          - [ ] コードレビュー完了
          - [ ] テスト実行確認
          - [ ] ドキュメント更新（必要に応じて）
          
          ### 🚀 次のステップ
          1. GitHub Copilot レビューが自動実行されます
          2. CI/CD パイプラインが実行されます
          3. レビュー完了後、マージ可能になります
          
          ---
          🤖 このPRは GitHub Actions により自動生成されました
        base: main
        branch: ${{ github.ref_name }}
        labels: |
          auto-generated
          needs-review

    - name: PR Info
      if: steps.cpr.outputs.pull-request-number
      run: |
        echo "Pull Request Number - ${{ steps.cpr.outputs.pull-request-number }}"
        echo "Pull Request URL - ${{ steps.cpr.outputs.pull-request-url }}"
        echo "✅ PR #${{ steps.cpr.outputs.pull-request-number }} が作成されました！"

    - name: Add comment with analysis
      if: steps.cpr.outputs.pull-request-number
      uses: peter-evans/create-or-update-comment@v3
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        issue-number: ${{ steps.cpr.outputs.pull-request-number }}
        body: |
          ## 🤖 GitHub Copilot 自動分析開始
          
          このPRに対して以下の分析を実行中です：
          
          - ✅ コード品質チェック
          - ✅ セキュリティスキャン  
          - ✅ パフォーマンス分析
          - ✅ ベストプラクティス検証
          
          分析結果は数分以内にコメントで報告されます。
          
          ---
          💡 **ヒント**: より詳細なレビューが必要な場合は `@github-actions` にメンションしてください。
